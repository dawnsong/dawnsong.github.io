"use strict";function randomInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}async function json2array(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}catch(t){throw t}}function getParam(t,e){const a=new URLSearchParams(window.location.search).get(t);return null!==a?a:e}function getRandomSubarray(t,e){e>t.length&&(e=t.length);for(var a,o,n=t.slice(0),r=t.length,i=r-e;r-- >i;)a=n[o=Math.floor((r+1)*Math.random())],n[o]=n[r],n[r]=a;return n.slice(i)}function moveDivToUl(){var t=$("div.page__footer-follow > ul.social-icons > li:nth-child(1)");t.css("color","red")}function safeObjClick(t){null!=t&&Object.keys(t).length>0&&"function"==typeof t.click&&t.click()}async function getStorageQuotaText(){if(!navigator.storage||"function"!=typeof navigator.storage.estimate)return{totalQuota:"N/A",usedQuota:"N/A",freeQuota:"N/A"};try{const t=await navigator.storage.estimate(),e=+(t.quota||0),a=+(t.usage||0),o=e-a;return{totalQuota:formatAsByteString(e),usedQuota:formatAsByteString(a),freeQuota:formatAsByteString(o)}}catch(t){return{totalQuota:"N/A",usedQuota:"N/A",freeQuota:"N/A"}}}function log4quota(){const{totalQuota:t,usedQuota:e,freeQuota:a}=getStorageQuotaText();document.getElementById("idbQuotaTotal").textContent=t,document.getElementById("idbQuotaUsed").textContent=e}function updateSongsURL2local(t){t.forEach(function(){})}var songIdx=randomInt(0,max10),jsonUrl=`https://storage.googleapis.com/xpub/playlists/${String(songIdx).padStart(8,"0")}.json`,nSongs=getParam("x",10);nSongs>10&&(songIdx=0,jsonUrl="https://storage.googleapis.com/xpub/playlists/all.json");const storeName="xLocalIDB",storeKey="fileName",dbVersion=1;let idb4songs=null;const formatAsByteString=t=>{const e=1073741824,a=1048576,o=1024;return t>e?`${(t/e).toFixed(2)} GB`:t>a?`${(t/a).toFixed(2)} MB`:`${(t/o).toFixed(2)}KB`},initIndexedDb=(t,e)=>new Promise((a,o)=>{const n=indexedDB.open(t,1);n.onerror=t=>{o(t.target.error)},n.onsuccess=t=>{t.target.result;a(t.target.result)},n.onupgradeneeded=t=>{e.forEach(e=>{t.target.result.createObjectStore(e.name,{keyPath:e.keyPath}).createIndex(e.keyPath,e.keyPath,{unique:!0})})}});window.addEventListener("load",async()=>{idb4songs=await initIndexedDb("xdb4songs",[{name:storeName,keyPath:storeKey}]),await log4quota(),json2array(jsonUrl).then(t=>{if(t){updateSongsURL2local(t);var e=new APlayer({element:document.getElementById("xplayer"),narrow:!1,mini:!1,autoplay:!1,loop:"all",order:"random",volume:1,preload:"auto",showlrc:!1,lrctype:3,mutex:!0,theme:"#ad7a86",listFolded:!0,audio:getRandomSubarray(t,nSongs)});e.audio.addEventListener("play",function(){var t=e.list.audios[e.list.index].name,a=e.list.audios[e.list.index].artist,o=$("#xplayer");if(o.length){document.title=a+" | "+t;var n=o[0].querySelector("time"),r=1;if(n){var i=new Date(n.getAttribute("datetime")).getTime();r=((new Date).getTime()-i)/6e4}else{var s=document.createElement("time");s.setAttribute("datetime",(new Date).toISOString()),s.style.display="none",o[0].appendChild(s),n=s}if(r>=1)safeObjClick($("#page4pixabay")[0]),n.setAttribute("datetime",(new Date).toISOString())}}),e.on("loadeddata",function(){})}});const t=$("#xplayer").parent(),e=$(".pixabay_widget");e.length&&e.prependTo(t)});