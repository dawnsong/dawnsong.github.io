<!DOCTYPE html> <html lang="cn"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 意公子講蘇軾 | Robust </title> <meta name="author" content="Xiaowei Song"> <meta name="description" content="吴敏婕重读苏轼的起伏人生"> <meta name="keywords" content="robust, big data, MRI, cryoET, cryoEM, healthcare"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://dawnsong.github.io/_digests/yiGongZi_suShi/"> <script src="/assets/js/theme.js?709e0f78aaa8187780f714018a77f74f"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <link rel="stylesheet" href="/assets/node_modules/aplayer/dist/xAPlayer.min.css"> <script src="/assets/node_modules/aplayer/dist/APlayer.min.js"></script> <script src="/assets/node_modules/js-cookie/dist/js.cookie.min.js"></script> <script src="/hifini/xhifini.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Robust </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/digests/">Digests </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Other </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/books/">bookshelf</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> <a class="dropdown-item " href="/publications/?x=100">publications</a> <a class="dropdown-item " href="/projects/">projects</a> <a class="dropdown-item " href="/news/">news</a> <a class="dropdown-item " href="/repositories/">repos</a> <a class="dropdown-item " href="/people/">people</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">意公子講蘇軾</h1> <p class="post-description">吴敏婕重读苏轼的起伏人生</p> </header> <article> <p>意公子自2013年开始做自媒体，2016年开始更新<a href="https://www.youtube.com/@EYart-yigongzi" rel="external nofollow noopener" target="_blank">Youtube</a> <d-cite key="yigongzi2016youtube"></d-cite>, 成名于其蘇軾系列。为方便开车送娃的时候听着学习，特整理其这个系列到此网页。</p> <blockquote> <p>意公子:把中華五千年文化長河裡，那些打動我們的人事物，帶進當下人們的生活。</p> <cite><a class="citation" href="#"></a></cite> </blockquote> <div class="language-plaintext highlighter-rouge highlight code-display-wrapper"> <table id="tbl4desc" class="stripe row-border order-column" cellspacing="0" width="100%"> <thead> <tr> <th></th> <th>idx</th> <th>description</th> </tr> </thead> </table> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0" id="cover4yiGongZi"> <figure> <picture> <source class="responsive-img-srcset" srcset="https://storage.googleapis.com/xmusic/yiGongZi/suShi/%E6%84%8F%E5%85%AC%E5%AD%90%E8%AC%9B%E8%98%87%E8%BB%BE_039.jpg?x-goog-signature=4226ab38946a51ffa59f8504a2a1636956d23699d57f393e896acf36d2ee27106d3f554d8ddac55fa3aa3a64e8bbd07d276dfb9c7f36efcf092680eceefaec6dbd9347495af481eab295f682e1a00b45a6a9155c02cf2721a54c1b477348344fdf9d46581d7fa538002998151c0c97dd1c20b582c20262f7aa5a63021ca9e916d2b5f7c7f238f6a0139a762932e3e17ee4ceee3c820f6c41b33415dab5d6ce9790d6a025777ee6b7a5b641221a90b59339e55b8d7ab5a0c8f369f36f134f3aa8c4a1b8c3679950ea26e73515fe4754db704066fdcefb5f90a507a94868090625a13c39c42bbaf61886e1f54accb4c3e9e0b6832b1200abcaa213b9f689c932a8&amp;x-goog-algorithm=GOOG4-RSA-SHA256&amp;x-goog-credential=xgcloud%40sigma-smile-436711-b7.iam.gserviceaccount.com%2F20251128%2Fus-east5%2Fstorage%2Fgoog4_request&amp;x-goog-date=20251128T234837Z&amp;x-goog-expires=604800&amp;x-goog-signedheaders=host" sizes="95vw"></source> <img src="https://storage.googleapis.com/xmusic/yiGongZi/suShi/%E6%84%8F%E5%85%AC%E5%AD%90%E8%AC%9B%E8%98%87%E8%BB%BE_039.jpg?x-goog-signature=4226ab38946a51ffa59f8504a2a1636956d23699d57f393e896acf36d2ee27106d3f554d8ddac55fa3aa3a64e8bbd07d276dfb9c7f36efcf092680eceefaec6dbd9347495af481eab295f682e1a00b45a6a9155c02cf2721a54c1b477348344fdf9d46581d7fa538002998151c0c97dd1c20b582c20262f7aa5a63021ca9e916d2b5f7c7f238f6a0139a762932e3e17ee4ceee3c820f6c41b33415dab5d6ce9790d6a025777ee6b7a5b641221a90b59339e55b8d7ab5a0c8f369f36f134f3aa8c4a1b8c3679950ea26e73515fe4754db704066fdcefb5f90a507a94868090625a13c39c42bbaf61886e1f54accb4c3e9e0b6832b1200abcaa213b9f689c932a8&amp;x-goog-algorithm=GOOG4-RSA-SHA256&amp;x-goog-credential=xgcloud%40sigma-smile-436711-b7.iam.gserviceaccount.com%2F20251128%2Fus-east5%2Fstorage%2Fgoog4_request&amp;x-goog-date=20251128T234837Z&amp;x-goog-expires=604800&amp;x-goog-signedheaders=host" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="yiGongZi_suShi_039" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Current playing episode. </div> <details><summary>Manage local indexedDB cached MP3s</summary> <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> <link rel="stylesheet" href="https://cdn.datatables.net/2.3.5/css/dataTables.dataTables.css"> <script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script> <script src="https://cdn.datatables.net/select/3.1.3/js/dataTables.select.js"></script> <script src="https://cdn.datatables.net/select/3.1.3/js/select.dataTables.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script> <div id="divTbl4idb"> <table id="tbl4idb" class="stripe row-border order-column" cellspacing="0" width="100%"> <thead> <tr> <th></th> <th>artist</th> <th>name</th> <th>mimeType</th> <th>size</th> <th>timestamp</th> </tr> </thead> </table> </div> </details> <script defer>
function waitForElement(selector, callback) {
  const observer = new MutationObserver((mutations, obs) => {
    const element = document.querySelector(selector);
    if (element) {
      obs.disconnect(); // Stop observing once the element is found
      callback(element);
    }
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true
  }); // Observe changes in the entire body
}
// Example usage:
waitForElement('#xplayer', (divElement) => {
  console.log('xplayer exists:', divElement);  
  // Perform actions on divElement
});
// // Simulate dynamic element creation
// setTimeout(() => {
//   const newDiv = document.createElement('div');
//   newDiv.id = 'myDynamicDiv';
//   newDiv.textContent = 'This is a dynamically added div.';
//   document.body.appendChild(newDiv);
// }, 1500);
//------------------------------------------------------------------------------

async function idb2dataArray(idb, storeName){
  return new Promise((resolve, reject) => {
    const transaction = idb.transaction([storeName], "readonly");
    const objectStore = transaction.objectStore(storeName);
    const allRecords = [];
    objectStore.openCursor().onsuccess = (event) => {
      const cursor = event.target.result;
      if (cursor) {
        let oneRow=cursor.value;
        //get basename and remove ext, i.e., get the stem
        let stem=oneRow['fileName'].split('/').pop().replace(/\.[^/.]+$/, '');
        oneRow['artist']=stem.split('__')[0];
        oneRow['name']=stem.split('__')[1];
        oneRow['size']=formatAsByteString(oneRow['size']);
        allRecords.push(oneRow);
        cursor.continue();
      } else {
        // All records have been retrieved, now convert to JSON
        try {
          // const jsonString = JSON.stringify(allRecords, null, 2); // null, 2 for pretty printing
          // resolve(jsonString);
          resolve(allRecords);
        } catch (error) {
          reject(`Error converting allRecords to JSON: ${error}`);
        }
      }
    };
    transaction.onerror = (event) => {
      reject(`Transaction error: ${event.target.errorCode}`);
    }; 
  });
}

const currentUrl = new URL(window.location.href);
const params = currentUrl.searchParams;
let cpPlaylist=params.get('playlist') ;
cpPlaylist=cpPlaylist !== null ? cpPlaylist : 'random';
console.log(cpPlaylist);
if(cpPlaylist=='random'){//no param has been passed yet to set the xPlayer
    params.set('playlist','yiGongZi_suShi');
    params.set('x','100');
    params.set('pRandom','0');
    currentUrl.search = params.toString();
    console.log(currentUrl);
    window.location.href = currentUrl.toString();    
}else{
    console.log(params)
    setTimeout(async () => {
        console.log(`ap: ${ap}`) ;
        ap.audio.addEventListener('play', async function(){ 
            let currentSong=ap.list.audios[ap.list.index];
            console.log(currentSong.cover);
            // let apCoverDiv=document.querySelector("div#cover4yiGongZi");
            // if(apCoverDiv){
            //     const image = apCoverDiv.querySelectorAll('img')[0];
            //     const timestamp = new Date().getTime(); // Get a unique timestamp
            //     image.src= `${currentSong.cover}?cachebuster=${timestamp}`; //force browser to refresh the image
            // };
            // let img=document.querySelector(".img-fluid");
            // // const timestamp = new Date().getTime(); // Get a unique timestamp
            // img.src=currentSong.cover ; // `${currentSong.cover}#cachebuster=${timestamp}`; 
            let srcSet=document.querySelector(".responsive-img-srcset");//only need to change the responsive source set!
            srcSet.srcset=currentSong.cover;
            let divCaption=document.querySelector("div.caption");
            divCaption.innerHTML   =`<p style='text-align: center;'>${currentSong.name}<br>${currentSong.artist}</p>`;
        });
        //list cached songs to the table
        if(typeof idb4songs !== 'undefined' && idb4songs!==null){
          if(typeof storeName === 'undefined')throw(`storeName cannot be found!!!`);
          let data4tbl=await idb2dataArray(idb4songs, storeName);
          // console.log(data4tbl);  
          renderData2table(data4tbl);
        }
    }, 3000); //allow 3 seconds delay/timeout to check if ap is loaded    
}

let dt=null, dt4desc=null;
function rmKey(key) {
  return new Promise((resolve, reject) => {
    if (!idb4songs) {
      reject(new Error('Database not initialized.'));
      return;
    }
    // 1. Initiate a read-write transaction
    const transaction = idb4songs.transaction([storeName], 'readwrite');
    const store = transaction.objectStore(storeName);
    // 2. Request to delete the specific key
    const request = store.delete(key);
    request.onerror = (event) => {
      console.error('Error deleting key:', event.target.error);
      reject(event.target.error);
    };
    request.onsuccess = (event) => {
      console.log(`Key '${key}' deleted successfully.`);
      resolve();
    };
  });
}
function renderData2table(arr4tb){ 
  if(dt!==null) {dt.destroy();}//restore to simple html table, still kept in DOM
  if(typeof ap == 'undefined')return;
  // Initialise the DataTable
  dt=new DataTable('#tbl4idb', {
    columnDefs: [
        {//checkbox for the 1st select col
            orderable: false,
            render: DataTable.render.select(),
            targets: 0,
            searchable: false            
        }
    ],
    columns: [{data:0}, { data: 'artist' },{ data: 'name' }, { data: 'mimeType' }, { data: 'size' }, 
      { data: 'timestamp', render: function (data, type, row) {
        if (type === 'display' || type === 'filter') {
            // Assuming 'data' is a timestamp in milliseconds
            // const date = new Date(data);//traditional JS way
            // const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            // return date.toLocaleDateString('en-US', options); 
            return moment(data).format('YYYYMMDD HH:mm');
        }
        return data; // For sorting and other types, return original data
      }}],
    data: arr4tb,
    // layout: {
    //   topStart: { }
    // },
    order: [[4, 'desc']],
    // select: true
    select: {
        style: 'os',
        selector: 'td:first-child'
    }
  });
  //make a `rm` btn to rm selected rows
  const btnRm = document.createElement('button');
  btnRm.textContent ="RM Selected ... ";
  btnRm.id='btnRm';
  btnRm.classList.add("dt-button");
  btnRm.addEventListener('click', async () => {    
    var selectedRowsData = dt.rows({ selected: true }).data();
    // Iterate through the selected rows' data
    selectedRowsData.each(async function(rowData) {
        console.log(rowData); // rowData will contain the data for each selected row        
        // if(await keyExists(rowData['fileName'])>0){
        await rmKey(rowData['fileName']);
        // }
    });
    //reload the data
    let data4tbl=await idb2dataArray(idb4songs, storeName);          
    renderData2table(data4tbl);
  });
  dtSearchParentDiv=document.querySelector(".dt-layout-cell.dt-end");
  dtSearchParentDiv.insertBefore(btnRm, dtSearchParentDiv.firstChild);
}

async function renderSuShi(){
  let data4suShi=await json2array('/hifini/yiGongZi/suShi-desc.json');
  console.log(data4suShi);
  let dt4desc=new DataTable('#tbl4desc', {
    columnDefs: [
        {//checkbox for the 1st select col
            orderable: false,
            render: DataTable.render.select(),
            targets: 0,
            searchable: false            
        }
    ],
    columns: [{data:0}, { data: 'index' },{ data: 'desc' }],
    order: [[1, 'asc']],
    data: data4suShi,    
    // select: true
    select: {
        style: 'os',
        selector: 'td:first-child'
    }
  });
}
setTimeout(async () => { await renderSuShi(); }, 5000);

</script> <blockquote> </blockquote> </article> <h2>References</h2> <div class="publications"> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> <div id="xplayer" style="text-align: left;"></div> <script type="text/javascript" src="https://storage.googleapis.com/xpub/playlists/json.js" defer></script> <script type="text/javascript" src="/hifini/xplayer.js" defer></script> Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> | <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a>. <b id="idbQuotaUsed"></b>|<b id="idbQuotaTotal"></b> © Copyright 2025 Xiaowei Song. Last updated: November 30, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?c29fd54348398a9a75966ef9a8e5d84b"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?2b177038d0885a876f47a3df6474238a" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-BYFL6HDBJH"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-BYFL6HDBJH');
  </script> <script defer src="/assets/js/google-analytics-setup.js"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>